-- ================= Services =================
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local Player = Players.LocalPlayer

-- ================= 設定 =================
local MAX_SPEED = 500
local CURRENT_SPEED = 200
local SPEED_ENABLED = false

-- ================= 狀態 =================
local CurrentSeat = nil
local OriginalSpeed = nil

-- ================= GUI =================
local ScreenGui = Instance.new("ScreenGui", Player.PlayerGui)
ScreenGui.ResetOnSpawn = false

local Main = Instance.new("Frame", ScreenGui)
Main.Size = UDim2.fromScale(0.28, 0.28)
Main.Position = UDim2.fromScale(0.36, 0.32)
Main.BackgroundColor3 = Color3.fromRGB(25,25,25)
Main.Active = true
Main.Draggable = true

local Title = Instance.new("TextLabel", Main)
Title.Size = UDim2.new(1,0,0.2,0)
Title.Text = "Boat Speed Control"
Title.TextColor3 = Color3.new(1,1,1)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20

local Toggle = Instance.new("TextButton", Main)
Toggle.Size = UDim2.fromScale(0.8,0.22)
Toggle.Position = UDim2.fromScale(0.1,0.3)
Toggle.Text = "速度修改：關閉"
Toggle.BackgroundColor3 = Color3.fromRGB(70,70,70)
Toggle.TextColor3 = Color3.new(1,1,1)
Toggle.Font = Enum.Font.SourceSansBold
Toggle.TextSize = 18

local SliderBg = Instance.new("Frame", Main)
SliderBg.Size = UDim2.fromScale(0.8,0.1)
SliderBg.Position = UDim2.fromScale(0.1,0.62)
SliderBg.BackgroundColor3 = Color3.fromRGB(50,50,50)

local SliderFill = Instance.new("Frame", SliderBg)
SliderFill.BackgroundColor3 = Color3.fromRGB(0,170,255)
SliderFill.Size = UDim2.new(CURRENT_SPEED / MAX_SPEED,0,1,0)

local SpeedText = Instance.new("TextLabel", Main)
SpeedText.Size = UDim2.fromScale(1,0.15)
SpeedText.Position = UDim2.fromScale(0,0.75)
SpeedText.Text = "Speed : "..CURRENT_SPEED
SpeedText.TextColor3 = Color3.new(1,1,1)
SpeedText.BackgroundTransparency = 1
SpeedText.Font = Enum.Font.SourceSansBold
SpeedText.TextSize = 18

-- ================= 開關 =================
Toggle.MouseButton1Click:Connect(function()
	SPEED_ENABLED = not SPEED_ENABLED

	if SPEED_ENABLED then
		Toggle.Text = "速度修改：開啟"
		Toggle.BackgroundColor3 = Color3.fromRGB(0,120,0)
		if CurrentSeat then
			CurrentSeat.MaxSpeed = CURRENT_SPEED
		end
	else
		Toggle.Text = "速度修改：關閉"
		Toggle.BackgroundColor3 = Color3.fromRGB(70,70,70)
		if CurrentSeat and OriginalSpeed then
			CurrentSeat.MaxSpeed = OriginalSpeed
		end
	end
end)

-- ================= 滑桿 =================
local dragging = false
SliderBg.InputBegan:Connect(function(i)
	if i.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
	end
end)

UserInputService.InputEnded:Connect(function(i)
	if i.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = false
	end
end)

RunService.RenderStepped:Connect(function()
	if not dragging then return end
	local x = UserInputService:GetMouseLocation().X
	local sx = SliderBg.AbsolutePosition.X
	local w = SliderBg.AbsoluteSize.X
	local p = math.clamp((x - sx) / w, 0, 1)

	CURRENT_SPEED = math.floor(p * MAX_SPEED)
	SliderFill.Size = UDim2.new(p,0,1,0)
	SpeedText.Text = "Speed : "..CURRENT_SPEED

	if SPEED_ENABLED and CurrentSeat then
		CurrentSeat.MaxSpeed = CURRENT_SPEED
	end
end)

-- ================= 坐船偵測（關鍵） =================
local function onCharacter(char)
	local hum = char:WaitForChild("Humanoid")

	hum.Seated:Connect(function(sitting, seat)
		if sitting and seat:IsA("VehicleSeat") then
			CurrentSeat = seat
			OriginalSpeed = seat.MaxSpeed

			if SPEED_ENABLED then
				seat.MaxSpeed = CURRENT_SPEED
			end
		else
			if CurrentSeat and OriginalSpeed then
				CurrentSeat.MaxSpeed = OriginalSpeed
			end
			CurrentSeat = nil
			OriginalSpeed = nil
		end
	end)
end

if Player.Character then
	onCharacter(Player.Character)
end
Player.CharacterAdded:Connect(onCharacter)
