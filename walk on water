-- ================= Services =================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- ================= GUI =================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "WaterWalkGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 250, 0, 100)
MainFrame.Position = UDim2.new(0.5, -125, 0.5, -50)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 10)
UICorner.Parent = MainFrame

-- 標題
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.Text = "Water Walk"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20
Title.Parent = MainFrame

-- 縮小按鈕
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -35, 0, 0)
MinimizeButton.Text = "-"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MinimizeButton.Parent = MainFrame

-- 關閉按鈕
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -70, 0, 0)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
CloseButton.Parent = MainFrame

-- 功能按鈕
local WalkButton = Instance.new("TextButton")
WalkButton.Size = UDim2.new(1, -20, 0, 50)
WalkButton.Position = UDim2.new(0, 10, 0, 40)
WalkButton.Text = "Enable Water Walk"
WalkButton.TextColor3 = Color3.fromRGB(255, 255, 255)
WalkButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
WalkButton.Parent = MainFrame

-- ================= GUI 功能 =================
local minimized = false
MinimizeButton.MouseButton1Click:Connect(function()
    minimized = not minimized
    MainFrame.Size = minimized and UDim2.new(0, 250, 0, 30) or UDim2.new(0, 250, 0, 100)
end)

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- ================= 水上行走 =================
local waterWalkEnabled = false
local platform

-- 建立平台
local function createPlatform()
    if platform then platform:Destroy() end
    platform = Instance.new("Part")
    platform.Size = Vector3.new(50, 1, 50)
    platform.Anchored = true
    platform.CanCollide = true
    platform.Transparency = 1
    platform.Name = "WaterWalkPlatform"

    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local waterY = Workspace:FindFirstChild("Water") and Workspace.Water.Position.Y or 0
    local offset = -3
    platform.Position = Vector3.new(hrp.Position.X, waterY + offset, hrp.Position.Z)
    platform.Parent = Workspace
end

-- 更新平台
local function updatePlatform()
    if not platform then return end
    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local waterY = Workspace:FindFirstChild("Water") and Workspace.Water.Position.Y or 0
    local playerY = hrp.Position.Y
    local offset = -3

    if playerY < waterY then
        platform.CanCollide = false
    else
        platform.CanCollide = true
        platform.Position = Vector3.new(hrp.Position.X, waterY + offset, hrp.Position.Z)
    end
end

-- 開關功能
WalkButton.MouseButton1Click:Connect(function()
    waterWalkEnabled = not waterWalkEnabled
    WalkButton.Text = waterWalkEnabled and "Disable Water Walk" or "Enable Water Walk"
    if waterWalkEnabled then
        createPlatform()
    elseif platform then
        platform:Destroy()
        platform = nil
    end
end)

-- 持續更新平台
RunService.RenderStepped:Connect(function()
    if waterWalkEnabled then
        updatePlatform()
    end
end)
